# Captain's Log: 2026-01-07

## Version 3.75: CDF Import Examples Notebook Fixes

### Overview
Fixed `plotbot_cdf_import_examples.ipynb` to work correctly from the `example_notebooks/` directory and updated to use proper plotbot syntax patterns.

---

## Changes Made

### 1. Fixed File Path Issues

**Problem:** Notebook looked for CDF files using relative paths that didn't account for being run from `example_notebooks/` directory:
```python
cdf_dir = Path("data/cdf_files")  # Failed - looked in example_notebooks/data/
```

**Solution:** Added robust path handling that detects notebook location and adjusts:
```python
current_dir = Path.cwd()
if current_dir.name == "example_notebooks":
    plotbot_root = current_dir.parent
else:
    plotbot_root = current_dir
cdf_dir = plotbot_root / "data" / "cdf_files"
```

### 2. Updated to Proper Plotbot Syntax

**Problem:** "Advanced" section used internal implementation details instead of normal plotbot patterns:
```python
# Wrong - using internal APIs
waves_class = data_cubby.grab('psp_waves_auto')
lh_var = waves_class.get_subclass('wavePower_LH')
plotbot(trange, lh_var, 1)
```

**Solution:** Updated to use generated classes directly like all plotbot variables:
```python
# Correct - normal plotbot syntax
plotbot(trange, psp_waves_timeseries.wavePower_LH, 1)
```

### 3. Fixed Class Name Mismatches

**Problem:** Tutorial sections used inconsistent class names:
- First tutorial generated: `psp_waves_spectral`, `psp_waves_timeseries`
- Second tutorial looked for: `psp_waves_auto`, `psp_spectral_waves`

**Solution:** Standardized all references to use the classes actually generated by the first tutorial.

### 4. Added Direct Data Access Example

Added demonstration of accessing data properties (`.data`, `.datetime_array`, `.time`) from CDF-generated variables, showing they work identically to built-in plotbot classes:
```python
lh_data = psp_waves_timeseries.wavePower_LH.data
lh_datetime = psp_waves_timeseries.wavePower_LH.datetime_array
lh_time = psp_waves_timeseries.wavePower_LH.time
```

### 5. Improved Documentation Clarity

- Removed redundant tutorial sections
- Cleaned up code comments to be professional and clear
- Updated markdown cells to accurately reflect functionality
- Fixed broken file path example (docs/implementation_plans/CDF_Integration/KP_wavefiles)

---

## Files Modified

- `example_notebooks/plotbot_cdf_import_examples.ipynb` - Complete notebook overhaul
- `plotbot/__init__.py` - Version bump to v3.75
- `plotbot/cache/cdf_metadata/*.json` - CDF metadata cache updates
- `plotbot/data_classes/custom_classes/psp_waves_*.py` - Regenerated CDF classes

---

## Testing

Notebook now successfully:
1. ‚úÖ Finds CDF files from `example_notebooks/` directory
2. ‚úÖ Generates plotbot classes via `cdf_to_plotbot()`
3. ‚úÖ Plots timeseries and spectral variables
4. ‚úÖ Demonstrates mixed plots (spectral + timeseries)
5. ‚úÖ Shows direct data access patterns
6. ‚úÖ Uses standard plotbot syntax throughout

---

## Notes

This update makes the CDF import workflow accessible for users like Jay who need to import Kristoff's wave files. The notebook now provides a clean, working example of the complete workflow from CDF file to plotbot visualization.

**v3.75 Update: Fixed CDF import examples notebook paths and usage patterns**

---

## Version 3.76: Wildcard Pattern Generation for Single CDF Files

### Overview
Removed validation requirement that prevented wildcard patterns from being generated when only a single CDF file exists. Now trusts pattern detection and generates wildcards based on filename analysis alone.

---

## Problem

Previously, when generating a class from a single CDF file:
```python
cdf_to_plotbot('PSP_wavePower_2021-04-29_v1.3.cdf', 'psp_waves')
```

The system would:
1. Detect date/version patterns: `_2021-04-29`, `_v1.3`
2. Generate wildcard pattern: `PSP_wavePower_*_v*.cdf`
3. **Validate** by checking if other files exist
4. If NO other files ‚Üí **revert to exact filename** (no wildcards!)

**Result:** Adding more wave files later wouldn't be detected without regenerating the class.

## Solution

Removed the validation step entirely. Now:
1. Detects date/version patterns ‚úÖ
2. Generates wildcard pattern ‚úÖ
3. **Trusts the pattern** - uses wildcards regardless of how many files exist ‚úÖ

The time filter during data loading ensures only relevant files are loaded, so there's no risk of loading wrong data.

## Code Changes

**File:** `plotbot/data_import_cdf.py` (lines 1576-1584)

**Removed:**
```python
# Validate pattern by checking if it finds other files
if len(validation_files) == 0:
    pattern = filename  # Fall back to exact match
```

**Added user-facing messages:**
```python
if replacements_made:
    print(f"  üéØ Generated file pattern: {pattern}")
    print(f"     This will match files with different dates/versions in: {directory}")
else:
    print(f"  üìå No date/version pattern detected, will only load: {pattern}")
    print(f"     Add more files with similar naming to enable multi-file loading")
```

## Testing

```bash
$ python -c "from plotbot.data_import_cdf import generate_file_pattern_from_cdf; \
  generate_file_pattern_from_cdf('data/cdf_files/PSP_wavePower_2021-04-29_v1.3.cdf', 'data/cdf_files')"

üîç Analyzing filename: PSP_wavePower_2021-04-29_v1.3.cdf
  üéØ Generated file pattern: PSP_wavePower_*_v*.cdf
     This will match files with different dates/versions in: data/cdf_files
```

## Benefits

- ‚úÖ Users can add more CDF files without regenerating classes
- ‚úÖ Clear feedback about what pattern was generated
- ‚úÖ Works for single-file or multi-file scenarios
- ‚úÖ Time filtering prevents loading wrong data

## Pattern Detection Coverage

Automatically detects:
- Date formats: `YYYY-MM-DD`, `YYYYMMDD`, `YYYY_DDD`
- Time formats: `HHMM`, `HHMMSS`
- Versions: `v1.2`, `v01`, `version1`
- Sequential: `_001`, `_02`

Custom naming conventions can be handled by users understanding the pattern and adding matching files.

---

**v3.76 Feature: CDF wildcard patterns now generated from single files**
